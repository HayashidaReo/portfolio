# Matchub (旧: nikken-next)

## 概要

**Matchub** は、日本拳法の大会運営を現代化・効率化するために開発された、**オフラインファースト・リアルタイム大会運営プラットフォーム**です。
従来の得点板機能に加え、Web技術（Next.js）とデスクトップ技術（Electron）を融合させ、**「ネットがない体育館でも動く」「ネットがあれば端末間でリアルタイムに同期できる」** ハイブリッドな運用環境を提供します。

---

## 開発背景

日本拳法の大会運営における「紙ベースの煩雑さ」「既存得点板の使いにくさ」という課題からスタートしました。
当初は単なるWeb得点板でしたが、現場の **「ネット環境が不安定な体育館で止まっては困る」** という切実な声に応えるため、アーキテクチャを根本から見直し、**完全オフライン動作** と **クラウド同期** を両立するシステムへと進化しました。

---

## 主な機能

### 1. 🛡️ オフラインファースト・アーキテクチャ
*   **ネット接続不要**: アプリケーションはローカルデータベース (**IndexedDB / Dexie.js**) で動作するため、インターネットが切断されても試合進行・データ保存が止まることはありません。
*   **自動同期**: ネット接続が復帰すると、バックグラウンドで自動的にクラウド (**Firebase**) とデータを同期します。データのコンフリクトを避けるため、オフライン中に変更した情報は手動で送信します。

### 2. 📺 リアルタイム・モニタースコアボード
*   **デュアルディスプレイ対応**: PCに接続された外部モニターやプロジェクターに、観客用のスコアボードを表示します。
*   **遅延ゼロ**: **Presentation API** を使用してブラウザから直接セカンドスクリーンを制御するため、ネットワーク遅延が一切ありません。
*   **フォールバック**: Presentation API非対応環境では、**Broadcast Channel API** を用いて別タブ表示モードに自動で切り替わります。

### 3. ⚡ インスタントモード
*   **登録不要**: アカウント登録や複雑な大会設定なしで、アプリを開いて選手名を入力するだけですぐにスコアリングを開始できます。

### 4. 📝 統合大会管理
*   **選手登録**: 参加者データの一元管理。
*   **トーナメント管理**: 勝ち上がり表の作成と進行管理（※開発中）。
*   **複数大会対応**: 新人戦・本戦など、複数の大会を並行して管理可能。

### 5. 💻 クロスプラットフォーム
*   **Web版**: インストール不要でブラウザから利用可能。
*   **デスクトップ版 (Electron)**: 専用アプリとしてインストールし、より安定したネイティブ体験を提供（完全なオフライン動作など）。

---

## 技術スタック

モダンなWeb技術をベースに、堅牢性とパフォーマンスを重視した選定を行っています。

### フロントエンド / アプリケーション
*   **Framework**: [Next.js 16 (App Router)](https://nextjs.org/) - 最新のReactサーバーコンポーネントアーキテクチャを採用。
*   **UI Library**: [React 19](https://react.dev/)
*   **Styling**: [Tailwind CSS](https://tailwindcss.com/) - メンテナンス性とデザインの統一性を確保。
*   **Desktop Wrapper**: [Electron](https://www.electronjs.org/) - Webアプリをネイティブデスクトップアプリとしてパッケージング。

### 状態管理・データ連携
*   **Local DB**: [Dexie.js](https://dexie.org/) (IndexedDB wrapper) - 高速なローカルデータ永続化。
*   **Server State**: [TanStack Query v5](https://tanstack.com/query/latest) - 非同期データの取得・キャッシュ・同期管理。
*   **Client State**: [Zustand](https://github.com/pmndrs/zustand) - 試合中のタイマーやスコアなど、高頻度で更新されるUI状態の管理。

### バックエンド / インフラ
*   **Cloud DB**: [Firebase Firestore](https://firebase.google.com/) - リアルタイムクラウドデータベース。
*   **Auth**: Firebase Authentication - 堅牢な認証システム。
*   **Serverless**: Firebase Cloud Functions - サーバーサイドロジック（データ整合性チェック、admin権限が必要な処理など）。
*   **Hosting**: Vercel (Web版)

---

## 技術的なこだわり：ハイブリッド・シンク (Hybrid Sync)

本プロジェクト最大の特徴は、**Local-First（ローカルファースト）** なデータフローです。

1.  **Write Local**: ユーザーの操作（得点入力など）は、まず**即座にローカルDB (Dexie)** に書き込まれます。これにより、UIは通信待ち時間ゼロで反応します（Optimistic UI）。
2.  **Sync Background**: データがローカルに保存された後、**Sync Worker** がバックグラウンドでクラウド (Firestore) との差分を検知し、自動的にアップロードします。
3.  **Conflict Resolution**: オフライン中に別の端末でデータが変更された場合の競合解決ロジックも実装し、データの整合性を保ちます。

この仕組みにより、**「スタンドアロンアプリの快適さ」** と **「クラウドアプリの利便性」** のいいとこ取りを実現しています。

---

## 今後のロードマップ

*   **トーナメント表（ブラケット）の自動生成**: 選手データに基づいた対戦表の自動作成。