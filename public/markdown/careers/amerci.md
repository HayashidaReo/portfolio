# はじめに

## バイト先について

厳選された食品や雑貨を販売する個人営業のセレクトショップです。ここでは、業務の基盤としてExcelとVBAで構築されたレジ・在庫管理システムが使われていました。

## 改善のきっかけ

2022年12月から接客、レジ、納品など幅広い業務を担当するスタッフとして働き始めました。業務を遂行する中で非効率な点に気づき、これを改善したいという思いからオーナーに提案し、システムの改良に着手しました。

---
# 具体的な改良事例

## 1. 発注書作成の半自動化

### 概要

レジ内の商品情報を活用し、必要な商品を選択するだけで発注書を自動作成・PDF化し、取引先へメール送信するシステムです。

### 使用技術

* VBA
* Excel関数
* Outlook

### 従来の問題点

手作業でWordに発注情報を入力し、金額も手計算で行っていたため、入力ミスや計算ミスが頻発していました。そして発行後に、手動でPDF変換とメール送信を行うため、多くの時間と手間がかかっていました。

### 改良点

* 商品選択と個数入力のみで発注書が自動作成され、手作業を大幅に削減。
* 作成した発注書のPDF化と取引先へのメール送信を自動化し、作業を効率化。
* 発注商品を自動で納品待機リストに登録することで、納品時の作業負担を軽減。

## 2. QRコードシール発行の全自動化

### 概要

納品された商品に貼るQRコードシールの発行作業を、Pythonを用いて全自動化するプログラムです。

### 使用技術

* VBA
* Python (PyAutoGUI)

### 従来の問題点

納品作業には冷蔵物もあるため迅速性が求められますが、従来は以下の手動ステップが多く、約3分かかっていました。

1.  レジ・在庫管理システムで納品商品の情報をCSVファイルとして作成
2.  CSVファイルをシール発行ソフト（P-touch）に手動でインポート
3.  各種設定を手動で行いシールを発行

特にステップ2と3で多くの選択・入力項目があり、時間短縮が課題でした。

### 改良点

* CSVファイル作成後、残りのインポートと設定・発行作業を全自動化。
* 手作業で約3分かかっていたシール発行作業を**約30秒に短縮**し、作業効率を大幅に向上。


## 3. BASE在庫数更新の自動化

レジ・在庫管理システムの在庫情報を、ネットショップ「BASE」へ自動的に反映させるシステムです。
2段階に分けて自動化・改善を行いました。


### **フェーズ1：VBAによる半自動化システムの構築**

#### 概要

まず、レジ・在庫管理システム（Excel/VBA）からBASEにアップロードするためのCSVファイルを自動生成する仕組みを構築しました。

#### 使用技術

* VBA
* Excel関数

#### 従来の問題点

全商品をBASEで販売して売上を最大化するには、正確な在庫数を反映させる必要がありました。しかし、手動での在庫管理は時間がかかり、計算ミスや更新漏れのリスクが高く、結果として在庫に余裕のある一部商品しか出品できていませんでした。

#### 改良点と成果

* VBAを用いて、商品IDと賞味期限に基づいた適切な在庫数を自動計算し、CSVファイルとして出力するロジックを構築。
* 賞味期限が近い商品の販売停止や割引フラグの管理も自動化し、在庫管理の精度を向上。
* これにより、手動でのデータ入力と計算作業が大幅に削減され、より多くの商品をBASEに出品可能に。

#### 残された課題

この段階ではCSVファイルのBASEへのインポートは手動で行う必要がありました。また、複雑なロジックをVBAとExcel関数で実装したためコードの保守性が低く、更新も1日1回が限界でした。そのため、実店舗で商品が売れた際に在庫のズレが生じ、BASE上で在庫不足が発生するリスクが残っていました。


### **フェーズ2：PythonとBASE APIによる全自動化システムの実現**

#### 概要

フェーズ1で残った課題を解決するため、PythonとBASE APIを活用した完全自動の在庫連携システムを構築しました。

#### 使用技術

* Python
* BASE API
* VBA

#### 改良点と成果

##### 完全自動化の実現
在庫システムからのデータ抽出はVBAで行い、その後の複雑な計算処理（在庫数、割引タグなど）とBASEへのデータ反映は、すべてPythonとBASE APIを介して自動で行うようにしました。これにより、手動でのインポート作業が完全に不要になりました。

##### 在庫連携のリアルタイム化
APIを直接利用することで、より頻繁な在庫更新が可能になり、実店舗とBASE間での在庫差異を最小限に抑え、在庫不足による販売機会の損失リスクを大幅に低減しました。

##### 保守性の向上
Excel/VBAに依存していた複雑なロジックをPythonに移行したことで、コードの可読性と保守性が格段に向上し、将来的な仕様変更にも対応しやすい設計となりました。

---
## 4. 賞味期限管理画面の作成・自動割引適用

### 概要

賞味期限管理画面を作成し、割引設定された商品の可視化と割引処理の自動適用を実現するシステムです。

{{stockManager|medium|賞味期限管理画面}}

### 使用技術

* VBA

### 従来の問題点

在庫画面で賞味期限をフィルターして手動でチェックしていたため、以下の問題が発生していました。

1.  **チェック漏れ:** 手動作業により、期限の近い商品を見落とす可能性が高かった。
2.  **割引処理の不透明さ:** 割引シールの有無がシステム上で分からず、レジでの割引処理が手動となり、処理漏れや期限切れ商品の回収忘れが発生することがあった。

### 改良点

* 各商品の割引開始期間を事前に設定。毎日自動で割引開始商品を洗い出し、一覧で表示する画面を作成。
* レジでの割引処理をシステムに自動適用するように修正。手動での処理が不要となり、作業時間の短縮とエラーの減少を実現。
---

## 5. BASEおすすめ商品の自動更新(設計まで完了, 現在実装中)
### 1. 概要
本機能は、ECプラットフォーム「BASE」のショップ運営における
1. 月替りのおすすめ商品選定
2. 全商品の在庫状況を考慮した並び替え
という2つの主要な手作業を自動化するものです。

ショップオーナー（店舗スタッフ）が「夏に合う調味料」といった簡単な指示（プロンプト）を入力するだけで、Gemini APIが最適な商品を選定。同時に、300点を超える全商品を「おすすめ商品」「在庫あり」「在庫切れ」の3グループに分類し、顧客体験を最適化する順序で自動的に並び替えます。

### 2. 解決したい課題
1. 膨大な並び替え工数: 300点以上の商品を、種類ごとにまとまるよう手作業で並び替える作業に、膨大な時間がかかっています。
2. 顧客の離脱（売り切れ問題）: 在庫切れの商品がショップの上位にまとまって表示されていると、顧客は見るのをやめて離脱しやすくなります。
3. おすすめ選定の手間: 毎月のおすすめ商品（約5点）を選定し、BASE上で手動で「おすすめ」タグを付け替える作業が負担になっています。

### 3. 主な機能と処理フロー
この機能は、設計書で示された「ジョブベースの状態管理」を採用し、以下のステップで実行されます。

{{baseAi|medium|処理フロー}}

#### Step 1: ジョブの開始（Flutter App）
オーナーがアプリ上で「今月のおすすめテーマ」（例: 夏に合う調味料）を入力し、「更新開始」ボタンを押します。

#### Step 2: AIによるおすすめ選定（Cloud Functions - バックグラウンド）
全商品データを取得し、オーナーが入力したテーマ（夏に合う調味料）と共にGemini APIに送信します。

#### Step 3: カテゴリ（タグ）の自動付け替え（Cloud Functions - バックグラウンド）
まず、既存の「おすすめ」タグを全商品から削除します。
次に、Step 2でAIが選定した5商品に対し、BASE API経由で「おすすめ」タグを付与します。

#### Step 4: 全商品のソートロジック実行（Cloud Functions - バックグラウンド）
全商品（300点以上）を、以下の優先順位でソートするリストを作成します。
 * 最優先 (Group 1): Step 3で「おすすめ」タグが付いた商品。
 * 中間 (Group 2): 在庫ありの商品。これらは「あらかじめ設定した条件（種類ごと）」で内部ソートされます。
 * 最後 (Group 3): 在庫切れの商品。これらも「条件（種類ごと）」でソートされます。

#### Step 5: 表示順の一括更新（Cloud Functions - バックグラウンド）
Step 4で作成した最終的なソート順リストに基づき、BASE APIを順次呼び出し、全商品の表示順を一括で更新します。

#### Step 6: 完了通知（Realtime DB → Flutter App）
Realtime DB上のジョブステータスが completed に更新されます。
アプリはそれをリアルタイムで検知し、オーナーに「おすすめと並び順の更新が完了しました」と通知します。

### 工夫点
#### 1. 非同期処理による堅牢性の確保
300点を超える全商品の並び替え（API通信）は時間がかかります。そこで、この処理を Cloud Functions の非同期バックグラウンドジョブ として設計しました。
これにより、店舗スタッフが操作を開始した後にスマートフォンの通信が途切れたり、アプリを（強制）終了したりしても、処理はサーバー側で停止することなく安全に継続・完了されます。

#### 2. 日常の運用に溶け込むUI設計
この機能は、店舗スタッフが日常的に在庫管理などで使用している「Amerci公式アプリ内の管理者ページ」にインターフェイスを組み込みました。
これにより、お知らせ配信などのついでに、アプリから気軽にAIおすすめ選定を実行できるようになり、運用負荷を下げる工夫をしています。
